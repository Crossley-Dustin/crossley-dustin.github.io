<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Dustin's CSS3 Transitions, Transformations, and Animations</title>
        <link rel="stylesheet" type="text/css" href="topic_css/topic_layout.css">
    </head>
    <body>
        <main>
			<section id="section1">
				<h1>Hellooo</h1>
                <button onclick="showCasaCharacter()">Load File</button>
                <button onclick="clearLocalStorage()">Clear Storage</button>
                <p id="randomCharacter"></p>
                <div><img id="charImg"><p id="charQuote"></p></div>
			</section>
            <canvas id="c" width="800" height="200"></canvas>
        </main>

        <script>
            var cv = document.querySelector("#c");
            var ctx = cv.getContext("2d");

            //ctx.strokeRect(50,50,100,100)
            // ctx.beginPath();
            // ctx.moveTo(75,75);
            // ctx.lineTo(125,75);
            // ctx.lineTo(125,125);
            // ctx.lineTo(75,75);
            // ctx.fill();

            ctx.strokeStyle = "black";
            ctx.fillStyle = "white";
            ctx.font = "36pt Impact"
            ctx.textAlign = "center";
            ctx.fillText("CANVAS MEMES!", c.width/2, 40);

            ctx.lineWidth = 3;
            ctx.strokeText("CANVAS MEMES!", c.width/2, 40);


            // ctx.fillStyle = "blue";
            // ctx.fillRect(100,100,100,100);
            // ctx.strokeRect(50,50,50,50);

            function showCasaCharacter(){
                checkStorage();
                var cb = JSON.parse(localStorage.casa);
                var chars = cb.data.movies[0].actors;
                var randomNumChar = randomNumberGenerator(1,chars.length);

                var randChar = chars[randomNumChar-1];
                var quotesByCharacter = filterByID(randChar.actorId);
                var randomNumQuote = randomNumberGenerator(1,quotesByCharacter.length);

                var randQuote = quotesByCharacter[randomNumQuote-1];
                document.getElementById("randomCharacter").innerHTML = randChar.actorName;
                document.getElementById("charImg").src = randChar.urlPhoto;
                document.getElementById("charImg").alt = randChar.actorName;
                document.getElementById("charImg").addEventListener('touchend', evt => {
                    document.getElementById("charQuote").innerHTML = randQuote.quote[0];
                })
            }
            function filterByID(query){
                var cb = JSON.parse(localStorage.casa);
                var quotes = cb.data.movies[0].quotes;
                var filteredList = [];
                for (var i = 0; i < quotes.length; i++){
                    for (var j = 0; j < quotes[i].nameId.length; j++){
                        if (quotes[i].nameId[j] = query){
                            filteredList.push(quotes[i]);
                        }
                    }
                }
                return filteredList;
            }
            function checkStorage(){
                if (localStorage.getItem("casa") === null) {
                    // give a red light
                    storeJsonFile('bin/casblanca.json');
                } else {
                    // give a green light
                }
            }
            function randomNumberGenerator(min, max){
                // set our random number limits
                var minimum = min;
                var maximum = max;
                // do some math to get a whole number between our limits
                var randomnumber = Math.floor(Math.random() * (maximum - minimum + 1)) + minimum;
                return randomnumber;
            }
            function storeJsonFile(fileURL){
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function() {
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        //var response = JSON.parse(xhr.responseText);
                        localStorage.setItem("casa",xhr.responseText);
                        //showDetail(xhr.responseText,"daterInfo","div","col-4");
                    }
                }
                xhr.open("GET",fileURL,true);
                xhr.send();
            }
            function clearLocalStorage(){
                localStorage.clear();
            }
            window.onload = showCasaCharacter();
        </script>
    </body>
</html>
